<li class="nav-item dropdown" *ngIf="user; else loading">
  <button
    class="nav-link dropdown-toggle d-flex align-items-center"
    id="profileDropdown"
    type="button"
    data-bs-toggle="dropdown"
    aria-expanded="false"
    aria-controls="profileDropdownMenu"
    (click)="toggleDropdown()"
    [attr.aria-label]="'NAV.PROFILE_DROPDOWN' | translate"
  >
    <span class="avatar" aria-hidden="true">{{ getInitials() }}</span>
    <span class="visually-hidden">{{ user.firstName }} {{ user.lastName }}</span>
  </button>

  <ul
    id="profileDropdownMenu"
    class="dropdown-menu dropdown-menu-end profile-dropdown"
    aria-labelledby="profileDropdown"
  >
    <!-- Bouton de fermeture (croix) -->
    <li class="profile-close-btn-container">
      <button class="profile-close-btn" (click)="closeDropdown()" aria-label="Close profile menu">
        <span class="profile-close-icon"></span>
      </button>
    </li>

    <!-- En-tête -->
    <li class="dropdown-header text-center" role="heading" aria-level="3">
      <strong>{{ user.firstName }} {{ user.lastName }}</strong><br />
      <small class="text-muted">{{ user.email }}</small>
    </li>
    <li><hr class="dropdown-divider" /></li>

    <!-- Informations -->
    <li class="dropdown-info px-3 pb-2 text-muted">
      <div><strong>ID :</strong> <code>{{ user.userId }}</code></div>
      <div><strong>Rôle :</strong> {{ user.role || user.superRole || ('NAV.NO_ROLE' | translate) }}</div>
      <div>
        <strong>Entité :</strong>
        {{ user.entityName || ('NAV.NO_ENTITY' | translate) }}
        <span *ngIf="user.entityName" class="text-secondary">({{ user.entityType }})</span>
      </div>
    </li>
    <li><hr class="dropdown-divider" /></li>

    <!-- Options spécifiques par rôle -->
    <li *ngIf="currentRole === 'company' && currentSubRole === 'admin'">
      <a class="dropdown-item" routerLink="/company-home" (click)="closeDropdown()">
        {{ 'NAV.COMPANY.HOME' | translate }} <!-- Mon entreprise -->
      </a>
    </li>
    <li *ngIf="currentRole === 'company' && currentSubRole === 'admin'">
      <a class="dropdown-item" routerLink="/company/invitations" (click)="closeDropdown()">
        {{ 'NAV.INVITE_COLLEAGUES' | translate }}
      </a>
    </li>

    <li *ngIf="currentRole === 'institution' && currentSubRole === 'admin'">
      <a class="dropdown-item" routerLink="/institution-home" (click)="closeDropdown()">
        {{ 'NAV.INSTITUTION.HOME' | translate }} <!-- Mon institution -->
      </a>
    </li>
    <li *ngIf="currentRole === 'institution' && currentSubRole === 'admin'">
      <a class="dropdown-item" routerLink="/institution/invitations" (click)="closeDropdown()">
        {{ 'NAV.INVITE_COLLEAGUES' | translate }}
      </a>
    </li>

    <li *ngIf="currentRole === 'company' && currentSubRole !== 'admin'">
      <a class="dropdown-item" routerLink="/company-home" (click)="closeDropdown()">
        {{ 'NAV.COMPANY.HOME' | translate }}
      </a>
    </li>

    <li *ngIf="currentRole === 'institution' && currentSubRole !== 'admin'">
      <a class="dropdown-item" routerLink="/institution-home" (click)="closeDropdown()">
        {{ 'NAV.INSTITUTION.HOME' | translate }}
      </a>
    </li>

    <li *ngIf="currentRole === 'student'">
      <a class="dropdown-item" routerLink="/student-home" (click)="closeDropdown()">
        {{ 'NAV.STUDENT.CV' | translate }}
      </a>
    </li>
    <li *ngIf="currentRole === 'student'">
      <a class="dropdown-item" routerLink="/student/studies" (click)="closeDropdown()">
        {{ 'NAV.STUDENT.SEARCHES' | translate }}
      </a>
    </li>
    <li *ngIf="currentRole === 'student'">
      <a class="dropdown-item" routerLink="/student/internships" (click)="closeDropdown()">
        {{ 'NAV.STUDENT.APPLICATIONS' | translate }}
      </a>
    </li>

    <li *ngIf="currentRole === 'superadmin'">
      <a class="dropdown-item" routerLink="/superadmin-home" (click)="closeDropdown()">
        {{ 'NAV.SUPERADMIN.DASHBOARD' | translate }}
      </a>
    </li>
    <li *ngIf="currentRole === 'superadmin'">
      <a class="dropdown-item" routerLink="/superadmin/invitations" (click)="closeDropdown()">
        {{ 'NAV.SUPERADMIN.INVITE' | translate }}
      </a>
    </li>

    <li *ngIf="currentRole === 'landlord' && currentSubRole === 'privateLandlord'">
      <a class="dropdown-item" routerLink="/landlord-home" (click)="closeDropdown()">
        {{ 'NAV.LANDLORD.ANNOUNCES' | translate }}
      </a>
    </li>
    <li><hr class="dropdown-divider" /></li>
    <!-- Options communes -->
    <li>
      <a class="dropdown-item" routerLink="/landlord-home" (click)="goToProfile(); closeDropdown()">
        {{ 'NAV.PARAMETERS' | translate }} <!-- Mon profil -->
      </a>
    </li>
    <li><hr class="dropdown-divider" /></li>
    <li>
      <button class="dropdown-item text-danger" type="button" (click)="logout(); closeDropdown()">
        <i class="bi bi-box-arrow-right me-2"></i>
        {{ 'NAV.LOGOUT' | translate }}
      </button>
    </li>
  </ul>
</li>

<!-- État de chargement -->
<ng-template #loading>
  <li class="nav-item">
    <span class="nav-link disabled">
      <span class="avatar">?</span>
      <span class="visually-hidden">{{ 'NAV.LOADING' | translate }}</span>
    </span>
  </li>
</ng-template>
