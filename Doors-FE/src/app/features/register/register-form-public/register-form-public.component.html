<div class="full-wrapper" id="invitation-form-container">
  <div class="container">
    <h3 class="text-center">
      {{
        roleName === 'student'
          ? ('REGISTERPUBLIC.TITLE_STUDENT' | translate)
          : ('REGISTERPUBLIC.TITLE_LANDLORD' | translate)
      }}
    </h3>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="horizontal-form">
      <!-- Email -->
      <app-email-input
        [form]="form"
        [fieldError]="fieldError"
        emailControlName="email"
        [submitted]="validationTriggered"
        [readonly]="false"
      ></app-email-input>

      <!-- Prénom -->
      <div class="form-group">
        <label>
          {{ 'REGISTERPUBLIC.LABEL.FIRSTNAME' | translate }}
          <span class="required">*</span>
        </label>
        <input
          type="text"
          formControlName="firstName"
          class="form-control"
          [ngClass]="{
            'is-invalid': form.get('firstName')?.touched && (form.get('firstName')?.invalid || fieldError['firstName'])
          }"
        />
        <div class="invalid-feedback" *ngIf="form.get('firstName')?.touched">
          <ng-container *ngIf="form.get('firstName')?.hasError('required')">
            {{ 'SHARED.ERROR.FRONTEND.FIRSTNAME_REQUIRED' | translate }}
          </ng-container>
          <ng-container *ngIf="form.get('firstName')?.hasError('minlength')">
            {{ 'SHARED.ERROR.FRONTEND.FIRSTNAME_MINLENGTH' | translate }}
          </ng-container>
          <ng-container *ngIf="fieldError['firstName']">
            {{ fieldError['firstName'] | translate }}
          </ng-container>
        </div>
      </div>

      <!-- Nom -->
      <div class="form-group">
        <label>
          {{ 'REGISTERPUBLIC.LABEL.LASTNAME' | translate }}
          <span class="required">*</span>
        </label>
        <input
          type="text"
          formControlName="lastName"
          class="form-control"
          [ngClass]="{
            'is-invalid': form.get('lastName')?.touched && (form.get('lastName')?.invalid || fieldError['lastName'])
          }"
        />
        <div class="invalid-feedback" *ngIf="form.get('lastName')?.touched">
          <ng-container *ngIf="form.get('lastName')?.hasError('required')">
            {{ 'SHARED.ERROR.FRONTEND.LASTNAME_REQUIRED' | translate }}
          </ng-container>
          <ng-container *ngIf="form.get('lastName')?.hasError('minlength')">
            {{ 'SHARED.ERROR.FRONTEND.LASTNAME_MINLENGTH' | translate }}
          </ng-container>
          <ng-container *ngIf="fieldError['lastName']">
            {{ fieldError['lastName'] | translate }}
          </ng-container>
        </div>
      </div>

      <!-- Champs de mot de passe -->
      <app-password-input
        [form]="form"
        [fieldError]="fieldError"
        passwordControlName="password"
        confirmPasswordControlName="confirmPassword"
      ></app-password-input>

      <!-- Consentements légaux -->
      <div class="form-group">
        <div class="legal-consent-container" [ngClass]="{'is-invalid': validationTriggered && consentError}">
          <app-legal-consent
            source="register-form"
            (consentsChanged)="onConsentsChanged($event)"
            (documentTypesLoaded)="setExpectedConsentKeys($event)"
          ></app-legal-consent>
          <div *ngIf="validationTriggered && consentError" class="invalid-feedback consent-error">
            <p *ngIf="hasMissingConsents()" class="error-intro">
              {{ 'REGISTER.CONSENT_ERROR_INTRO' | translate }}
            </p>
            <ul class="error-list">
              <ng-container *ngFor="let key of expectedConsentKeys">
                <li *ngIf="!legalConsents[key]">
                  {{ 'REGISTER.CONSENT_REQUIRED' | translate: { document: documentMap[key].name || key } }}
                </li>
              </ng-container>
            </ul>
            <ng-container *ngIf="expectedConsentKeys.length === 0">
              {{ 'REGISTER.ALL_CONSENTS_REQUIRED' | translate }}
            </ng-container>
          </div>
        </div>
      </div>

      <!-- Erreur globale -->
      <div *ngIf="globalError" class="text-danger text-center mt-2">
        {{ globalError | translate }}
      </div>

      <!-- Bouton -->
      <div class="form-group button-container">
        <button type="submit" class="btn-submit">
          {{ 'REGISTERPUBLIC.BUTTON.SUBMIT' | translate }}
        </button>
      </div>
    </form>
  </div>
</div>
